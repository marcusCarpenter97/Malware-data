"""Given a directory, delete files that do not have a PE header."""
import os
import sys
import pefile

def is_file_pe(file_path):
    try:
        pe = pefile.PE(path)
        return True
    except pefile.PEFormatError:
        return False

mal_dir = sys.argv[1]

malware = os.listdir(mal_dir)
size = len(malware)

for idx, sample in enumerate(malware):
    print(f"{idx}/{size}")
    path = os.path.join(mal_dir, sample)
    if not is_file_pe(path):
        os.remove(path)

print(f"Number of pe files found: {len(os.listdir(mal_dir))}")
